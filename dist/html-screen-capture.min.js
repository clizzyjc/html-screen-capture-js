!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("htmlScreenCaptureJs",[],t):"object"==typeof exports?exports.htmlScreenCaptureJs=t():e.htmlScreenCaptureJs=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(a[n])return a[n].exports;var r=a[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var a={};return t.m=e,t.c=a,t.d=function(e,a,n){t.o(e,a)||Object.defineProperty(e,a,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var a=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(a,"a",a),a},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function e(){n(this,e),this.OBJECT="object",this.STRING="string",this.URI="uri",this.BASE64="base64"};t.default=r,e.exports=t.default},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t,a){return(new l.default).capture(e,t,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.OutputType=void 0,t.capture=r;var s=a(0),i=n(s),o=a(2),l=n(o);t.OutputType=new i.default},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=a(3),o=n(i),l=a(4),u=n(l),c=a(0),d=n(c),h=function(){function e(){r(this,e),this._logger=new o.default,this._isHead=!0,this._classMap={},this._classCount=0,this._shouldHandleImgDataUrl=!0,this._canvas=null,this._ctx=null,this._doc=null,this._options={tagsOfIgnoredDocHeadElements:["script","link","style"],tagsOfIgnoredDocBodyElements:["script"],classesOfIgnoredDocBodyElements:[],attrKeyValuePairsOfIgnoredElements:{},tagsOfSkippedElementsForChildTreeCssHandling:["svg"],attrKeyForSavingElementOrigClass:"_class",attrKeyForSavingElementOrigStyle:"_style",prefixForNewGeneratedClasses:"c",imageFormatForDataUrl:"image/png",imageQualityForDataUrl:.92,rulesToAddToDocStyle:[]}}return s(e,[{key:"_overrideOptions",value:function(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this._options[t]=e[t])}},{key:"_getCanvasDataUrl",value:function(e){var t="";try{t=e.toDataURL(this._options.imageFormatForDataUrl,this._options.imageQualityForDataUrl)}catch(e){this._logger.warn("getCanvasDataUrl() - "+e.message)}return t}},{key:"_getImgDataUrl",value:function(e){var t="";try{this._canvas||(this._canvas=this._doc.createElement("canvas"),this._ctx=this._canvas.getContext("2d")),this._canvas.width=e.clientWidth,this._canvas.height=e.clientHeight,this._ctx.drawImage(e,0,0),t=this._getCanvasDataUrl(this._canvas)}catch(e){this._logger.warn("getImgDataUrl() - "+e.message),this._shouldHandleImgDataUrl=!1}return t}},{key:"_getClasses",value:function(e){var t=[],a=e.className instanceof SVGAnimatedString?e.className.baseVal:e.className;if(a){a.split(" ").forEach(function(e){e&&t.push(e)})}return t}},{key:"_handleElmCss",value:function(t,a){this._getClasses(a).length>0&&(this._options.attrKeyForSavingElementOrigClass&&a.setAttribute(this._options.attrKeyForSavingElementOrigClass,e._getClassName(a)),a.removeAttribute("class")),a.getAttribute("style")&&(this._options.attrKeyForSavingElementOrigStyle&&a.setAttribute(this._options.attrKeyForSavingElementOrigStyle,a.getAttribute("style")),a.removeAttribute("style"));for(var n=getComputedStyle(t),r="",s=0;s<n.length;s++){var i=n.item(s),o="height"==i?t.getBoundingClientRect().height:n.getPropertyValue(i),l=i+":"+o,u=this._classMap[l];u||(this._classCount++,u=(this._options.prefixForNewGeneratedClasses?this._options.prefixForNewGeneratedClasses:"c")+this._classCount,this._classMap[l]=u),("TR"==t.tagName&&o<45||"TD"==t.tagName||"PRE"==t.tagName&&o<45||"SPAN"==t.tagName&&o<45)&&"height"==i?delete this._classMap[l]:r+=u+" "}r&&a.setAttribute("class",r.trim())}},{key:"_appendNewStyle",value:function(e){var t=this._doc.createElement("style");t.type="text/css";var a=this._options.rulesToAddToDocStyle?this._options.rulesToAddToDocStyle.join(""):"";for(var n in this._classMap)this._classMap.hasOwnProperty(n)&&(a+="."+this._classMap[n]+"{"+n+"}");t.styleSheet?t.styleSheet.cssText=a:t.appendChild(this._doc.createTextNode(a)),e.children[0].appendChild(t)}},{key:"_shouldIgnoreElm",value:function(e){var t=this,a=!1;if((this._isHead&&this._options.tagsOfIgnoredDocHeadElements&&this._options.tagsOfIgnoredDocHeadElements.indexOf(e.tagName.toLowerCase())>-1||!this._isHead&&this._options.tagsOfIgnoredDocBodyElements&&this._options.tagsOfIgnoredDocBodyElements.indexOf(e.tagName.toLowerCase())>-1)&&(a=!0),!a&&this._options.attrKeyValuePairsOfIgnoredElements)for(var n in this._options.attrKeyValuePairsOfIgnoredElements)if(this._options.attrKeyValuePairsOfIgnoredElements.hasOwnProperty(n))for(var r=0;r<e.attributes.length;r++)e.attributes[r].specified&&e.attributes[r].value===this._options.attrKeyValuePairsOfIgnoredElements[n]&&(a=!0);if(!a&&!this._isHead&&this._options.classesOfIgnoredDocBodyElements){this._getClasses(e).forEach(function(e){!a&&t._options.classesOfIgnoredDocBodyElements.indexOf(e)>-1&&(a=!0)})}return a}},{key:"_recursiveWalk",value:function(t,a,n){if(this._shouldHandleImgDataUrl&&!this._isHead&&"img"===t.tagName.toLowerCase()){var r=this._getImgDataUrl(t);r&&a.setAttribute("src",r)}if(!this._isHead&&"canvas"===t.tagName.toLowerCase()){var s=this._getCanvasDataUrl(t);s&&a.setAttribute("src",s),a.outerHTML=a.outerHTML.replace(/<canvas/g,"<img")}if(t.value&&e._handleElmValue(t,a),n&&(this._handleElmCss(t,a),this._options.tagsOfSkippedElementsForChildTreeCssHandling&&this._options.tagsOfSkippedElementsForChildTreeCssHandling.indexOf(t.tagName.toLowerCase())>-1&&(n=!1)),t.children)for(var i=t.children.length-1;i>=0;i--)this._shouldIgnoreElm(t.children[i])?a.removeChild(a.children[i]):this._recursiveWalk(t.children[i],a.children[i],n)}},{key:"_createNewHtml",value:function(){var e=this._doc.documentElement.cloneNode(!1);return this._handleElmCss(this._doc.documentElement,e),e}},{key:"_appendNewHead",value:function(e){var t=this._doc.head.cloneNode(!0);this._isHead=!0,this._recursiveWalk(this._doc.head,t,!1),e.appendChild(t)}},{key:"_appendNewBody",value:function(e){var t=this._doc.body.cloneNode(!0);this._isHead=!1,this._recursiveWalk(this._doc.body,t,!0),e.appendChild(t)}},{key:"_getHtmlObject",value:function(){var e=this._createNewHtml();return this._appendNewHead(e),this._appendNewBody(e),this._appendNewStyle(e),e}},{key:"_prepareOutput",value:function(e,t){var a=null,n=new d.default;if(t&&t.toLowerCase()!==n.OBJECT){var r=(e?e.outerHTML:"")||"";r&&(t.toLowerCase()===n.STRING?a=r:t.toLowerCase()===n.URI?a=u.default.uriEncode(r):t.toLowerCase()===n.BASE64&&(a=u.default.base64Encode(r))),a=a||""}else a=e;return this._logger.isDebug()&&this._logger.debug("output: "+(a.outerHTML?a.outerHTML:a)),a}},{key:"capture",value:function(e,t,a){var n=null,r=(new Date).getTime();try{this._overrideOptions(a),this._doc=t||document,this._logger.setLogLevel(this._options.logLevel),this._logger.info("capture() outputType: "+e+" - start");var s=this._getHtmlObject();n=this._prepareOutput(s,e)}catch(e){this._logger.error("capture() - error - "+e.message)}finally{this._logger.info("capture() - end - "+((new Date).getTime()-r)+"ms")}return n}}],[{key:"_getClassName",value:function(e){var t=e.className;return t instanceof SVGAnimatedString?t.baseVal:t}},{key:"_handleElmValue",value:function(e,t){if("input"===e.tagName.toLowerCase()&&"text"===e.getAttribute("type"))t.setAttribute("value",e.value);else if("select"===e.tagName.toLowerCase()&&e.children){t.setAttribute("value",e.value);for(var a=e.children.length-1;a>=0;a--)e.children[a].getAttribute("value")===e.value?t.children[a].setAttribute("selected",""):t.children[a].removeAttribute("selected")}}}]),e}();t.default=h,e.exports=t.default},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=function(){function e(){n(this,e),this._logLevelNames=["debug","info","warn","error","fatal","off"],this.init()}return r(e,[{key:"init",value:function(){this._logLevel=this._logLevelNames.indexOf("warn")}},{key:"setLogLevel",value:function(e){e&&-1!==this._logLevelNames.indexOf(e.toLowerCase())&&(this._logLevel=this._logLevelNames.indexOf(e.toLowerCase()))}},{key:"_log",value:function(e,t){this._logLevel<=this._logLevelNames.indexOf(t)&&console.log("|html-screen-capture-js|"+t+"| "+e)}},{key:"isDebug",value:function(){return this._logLevel===this._logLevelNames.indexOf("debug")}},{key:"debug",value:function(e){this._log(e,"debug")}},{key:"info",value:function(e){this._log(e,"info")}},{key:"warn",value:function(e){this._log(e,"warn")}},{key:"error",value:function(e){this._log(e,"error")}},{key:"fatal",value:function(e){this._log(e,"fatal")}}]),e}();t.default=s,e.exports=t.default},function(e,t,a){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=function(){function e(){n(this,e)}return r(e,null,[{key:"_utf8_encode",value:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",a=0;a<e.length;a++){var n=e.charCodeAt(a);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}},{key:"base64Encode",value:function(t){var a="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=void 0,s=void 0,i=void 0,o=void 0,l=void 0,u=void 0,c=void 0,d=0;for(t=e._utf8_encode(t);d<t.length;)r=t.charCodeAt(d++),s=t.charCodeAt(d++),i=t.charCodeAt(d++),o=r>>2,l=(3&r)<<4|s>>4,u=(15&s)<<2|i>>6,c=63&i,isNaN(s)?u=c=64:isNaN(i)&&(c=64),a=a+n.charAt(o)+n.charAt(l)+n.charAt(u)+n.charAt(c);return a}},{key:"uriEncode",value:function(e){return(e?encodeURI(e):"")||""}}]),e}();t.default=s,e.exports=t.default}])});